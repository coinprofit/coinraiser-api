# API To Do List

- Fix edge cases
  - Using an invalid auth token seems to break things
- Coinbase Integration
  - ~~Store coinbase access and reset tokens on User model~~
  - ~~Integrate coinapi module~~
  - ~~Add support for access_token~~
  - ~~Add support for using refresh_token to get new access_token~~
    - ~~If a request fails to auth, then refresh tokens~~
  - When a Campaign is created
    - If user has linked to coinbase account, create wallet in user's coinbase account (wallet)
    - If user has not linked to coinbase account, create wallet in CoinRaiser's coinbase account (walletEscrow)
    - If connecting to linked user coinbase account fails, then fall back on using CoinRaiser account
  - When user links to coinbase
    - Iterate through user's campaigns
      - Create wallet in user's coinbase account for each campaign (wallet)
      - Transfer funds from coinraiser escrow wallet (walletEscrow) for campaign to user's coinbase wallet (wallet) for the campaign
    - Iterate through user's ious
      - TBD
      - For each IOU, prompt user to complete transaction
      - Completing transaction will convert an IOU into a Donation
      - New Donation is created and existing IOU is marked as 'paid' or removed.
  - When a Donation is created
    - Use Coinbase API to send BTC from donating user to campaign wallet
  - When a Claim is created
    - Use Coinbase API to send BTC from campaign escrow wallet to campaign owner's wallet
- Model Updates
  - User
    - avatar - upload image for user, or use Gravatar as fallback
  - Campaign
    - wallet - wallet address within the User's coinbase account
    - walletEscrow - wallet address within CoinRaiser's coinbase account
    - images - array of images for this campaign
  - Donation
    - paid - boolean indicator for whether donation was paid or not. if false, donation acts as an IOU.
    - paidAt - date donation was actually paid
  - Claim - new model for when a user claims money from a campaign (should this be called *Transaction*?)
    - user - user making the claim (must be owner of the campaign) who is receiving funds
    - campaign - campaign funds are being claimed from
    - amount - amount being transfered
    - transactionId - bitcoin transaction id
  - Image
    - owner
    - type
    - uri
- Middleware
  - Users
    - Remove ability to get list of all users
  - Donation
    - Only allow donation to be paid if user is linked to Coinbase
    - Only allow donation to be paid if it is less than they have in their coinbase wallet
  - Claim
    - Prevent user from creating claim if they don't own the campaign
- Email integration
  - Welcome email on signup
    - Account activation via email link
    - Account activation via code
  - Send confirmation email when email address is changed
    - Authorize email address change via email link
    - Authorize email address change via code
  - Send password reset email when password is forgotten
    - Link sent to email, when clicked should display password reset form
    - Code sent to email, can be used in-app to reset password
- Passwords
  - Change password
    - Update user password needs to hash new password
    - Update user password should require old password, but no attribute in User model for this
    - Should API be concerned with confirm password, or handle it client-side? No confirm attribute in User model.
  - Forgot password
    - Need endpoint that accepts username or email address and emails password reset token
    - Need endpoint that accepts password reset token and new password
    - Need an HTML page to display password reset form linked to from email

